<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë¬µì°Œë¹  (ë©”ì‹ ì € UI + ìë™ ë¼ìš´ë“œ + ì´ëª¨í‹°ì½˜)</title>
  <style>
    :root{
      --chat-bg: #b2c7da;
      --border: rgba(0,0,0,.08);
      --text: #111827;
      --muted: rgba(17,24,39,.55);

      --bubble-left: #ffffff;
      --bubble-right: #fee500;
      --bubble-sys: rgba(255,255,255,.55);

      --pad: 14px;
      --safeB: env(safe-area-inset-bottom);
      --safeT: env(safe-area-inset-top);
    }
    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      color: var(--text);
      background: var(--chat-bg);
    }

    /* í—¤ë” */
    .header{
      position: sticky;
      top: 0;
      z-index: 20;
      padding: calc(10px + var(--safeT)) var(--pad) 10px var(--pad);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .headerRow{ display:flex; align-items:center; gap: 10px; }
    .back, .iconBtn{
      width: 34px; height: 34px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      display:flex; align-items:center; justify-content:center;
      font-weight: 900;
      user-select:none;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
    }
    .titleWrap{ flex:1; min-width:0; }
    .title{
      font-weight: 900;
      font-size: 16px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .subtitle{
      margin-top:2px;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .headerBtns{ display:flex; gap: 8px; }

    /* ë³¸ë¬¸ */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 10px var(--pad) calc(190px + var(--safeB)) var(--pad);
    }
    .pills{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 10px 0 10px;
    }
    .pill{
      background: rgba(255,255,255,.92);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      white-space: nowrap;
    }

    .chatStage{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 22px;
      padding: 10px;
    }
    .statusLine{
      margin: 2px 4px 10px;
      font-weight: 900;
      color: rgba(17,24,39,.92);
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }

    .chat{
      height: min(64vh, 560px);
      overflow: auto;
      padding: 10px 8px;
      display:flex;
      flex-direction: column;
      gap: 10px;
      scroll-behavior: smooth;
    }

    .row{
      display:flex;
      align-items:flex-end;
      gap: 8px;
    }
    .row.left{ justify-content:flex-start; }
    .row.right{ justify-content:flex-end; }
    .row.sys{ justify-content:center; }

    .avatar{
      width: 32px; height: 32px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.80);
      display:flex; align-items:center; justify-content:center;
      font-weight: 900; font-size: 12px;
      user-select:none;
      flex: 0 0 auto;
    }

    .bubble{
      position: relative;
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
      line-height: 1.45;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: keep-all;
    }
    .bubble.left{
      background: var(--bubble-left);
      border-top-left-radius: 6px;
    }
    .bubble.right{
      background: var(--bubble-right);
      border-top-right-radius: 6px;
      font-weight: 900;
    }
    .bubble.sys{
      background: var(--bubble-sys);
      border-color: rgba(255,255,255,.40);
      box-shadow: none;
      font-weight: 900;
      text-align:center;
      max-width: 92%;
    }

    .bubble.left::before{
      content:"";
      position:absolute;
      left: -6px;
      bottom: 10px;
      width: 10px; height: 10px;
      background: var(--bubble-left);
      border-left: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      transform: rotate(45deg);
    }
    .bubble.right::before{
      content:"";
      position:absolute;
      right: -6px;
      bottom: 10px;
      width: 10px; height: 10px;
      background: var(--bubble-right);
      border-right: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      transform: rotate(-45deg);
    }

    .meta{
      font-size: 11px;
      color: rgba(17,24,39,.55);
      white-space: nowrap;
      user-select:none;
      margin-bottom: 2px;
    }

    .readLine{
      font-size: 11px;
      color: rgba(17,24,39,.55);
      user-select:none;
      margin-right: 6px;
      text-align: right;
      min-width: 36px;
    }

    /* íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° */
    .typing{
      display:inline-flex;
      gap: 4px;
      align-items:center;
      padding: 8px 10px;
      background: var(--bubble-left);
      border: 1px solid var(--border);
      border-radius: 16px;
      border-top-left-radius: 6px;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
      position: relative;
      max-width: 78%;
    }
    .typing::before{
      content:"";
      position:absolute;
      left: -6px;
      bottom: 10px;
      width: 10px; height: 10px;
      background: var(--bubble-left);
      border-left: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      transform: rotate(45deg);
    }
    .dot{
      width: 6px; height: 6px;
      border-radius: 999px;
      background: rgba(17,24,39,.35);
      animation: bounce 1.1s infinite;
    }
    .dot:nth-child(2){ animation-delay: .15s; }
    .dot:nth-child(3){ animation-delay: .30s; }
    @keyframes bounce{
      0%, 80%, 100% { transform: translateY(0); opacity: .55; }
      40% { transform: translateY(-4px); opacity: 1; }
    }

    /* í•˜ë‹¨ ì»´í¬ì € */
    .composer{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      z-index: 30;
      padding: 10px var(--pad) calc(10px + var(--safeB)) var(--pad);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
    }
    .composerInner{
      max-width: 980px;
      margin: 0 auto;
      display:grid;
      gap: 10px;
    }
    .actions{
      display:flex;
      gap: 8px;
      justify-content:flex-end;
      flex-wrap: wrap;
    }
    button.small{
      height: 40px;
      padding: 0 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background:#fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      font-weight: 900;
      cursor: pointer;
    }
    button.small:disabled{ opacity:.55; cursor:not-allowed; box-shadow:none; }

    .inputRow{
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .plusBtn{
      width: 40px; height: 40px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background:#fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      font-weight: 900;
      user-select:none;
      display:flex; align-items:center; justify-content:center;
    }
    .fakeInput{
      flex:1;
      height: 40px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      padding: 0 12px;
      display:flex;
      align-items:center;
      color: rgba(17,24,39,.55);
      font-size: 13px;
      user-select:none;
    }
    .sendBtn{
      width: 54px; height: 40px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--bubble-right);
      box-shadow: 0 6px 16px rgba(0,0,0,.10);
      font-weight: 900;
      user-select:none;
      display:flex; align-items:center; justify-content:center;
    }

    .quickRow{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    button.quick{
      height: 54px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: #fff;
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
      font-size: 16px;
      font-weight: 900;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    button.quick:active{ transform: translateY(1px); }
    button.quick:disabled{ opacity: .55; cursor:not-allowed; box-shadow:none; }

    /* ===== ì´ë¯¸ì§€ ë§í’ì„ (ì„ íƒ/ì´ëª¨í‹°ì½˜) ===== */
    .bubble.image{
      padding: 6px;
      background: transparent;
      border: none;
      box-shadow: none;
    }
    .bubble.image::before{ display:none; }
    .bubble.image img{
      max-width: 140px;
      border-radius: 16px;
      display: block;
      box-shadow: 0 8px 20px rgba(0,0,0,.12);
    }

    /* ë²„íŠ¼ì—ë„ ì•„ì´ì½˜ì²˜ëŸ¼ ë³´ì—¬ì£¼ê¸°(ì˜µì…˜) */
    .btnIcon{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
    }
    .btnIcon img{
      width: 26px;
      height: 26px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid rgba(0,0,0,.06);
    }

    @media (max-width: 720px){
      .bubble{ max-width: 88%; }
      .chat{ height: min(66vh, 560px); }
      .bubble.image img{ max-width: 120px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="headerRow">
      <div class="back">â€¹</div>
      <div class="titleWrap">
        <div class="title">ë¬µì°Œë¹  ëŒ€ê²°ë°©</div>
        <div class="subtitle" id="headerSub">ì»´í“¨í„° vs í”Œë ˆì´ì–´ Â· 3íŒ 2ì„ ìŠ¹</div>
      </div>
      <div class="headerBtns">
        <div class="iconBtn">â˜</div>
        <div class="iconBtn">â‰¡</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="pills">
      <div class="pill" id="pillPhase">ë‹¨ê³„: -</div>
      <div class="pill" id="pillAttacker">ê³µê²©ì: -</div>
      <div class="pill" id="pillRound">ë¼ìš´ë“œ: 1</div>
      <div class="pill" id="pillMatch">ë§¤ì¹˜: í”Œë ˆì´ì–´ 0ìŠ¹ : 0ìŠ¹ ì»´í“¨í„° (2ìŠ¹ ì„ ì·¨)</div>
    </div>

    <div class="chatStage">
      <div class="statusLine" id="status">R1 ì‹œì‘: ì•„ë˜ì—ì„œ ë¬µ/ì°Œ/ë¹ ë¥¼ ëˆŒëŸ¬ ì§„í–‰í•˜ì„¸ìš”.</div>
      <div class="chat" id="chat"></div>
    </div>
  </div>

  <div class="composer">
    <div class="composerInner">
      <div class="actions">
        <!-- ìë™ ë¼ìš´ë“œ ì§„í–‰ì´ë¯€ë¡œ, ë²„íŠ¼ì€ ë‚¨ê²¨ë‘ë˜ ê¸°ë³¸ ë¹„í™œì„±/ìˆ¨ê¹€ ëŠë‚Œ -->
        <button class="small" id="btnNextRound" disabled title="ë¼ìš´ë“œëŠ” ìë™ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤">ë‹¤ìŒ ë¼ìš´ë“œ(ìë™)</button>
        <button class="small" id="btnRestartMatch">ë§¤ì¹˜ ì¬ì‹œì‘</button>
      </div>

      <div class="inputRow">
        <div class="plusBtn">ï¼‹</div>
        <div class="fakeInput">ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”â€¦ (ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ë¬µ/ì°Œ/ë¹  ì´ëª¨í‹°ì½˜ ì „ì†¡)</div>
        <div class="sendBtn">ì „ì†¡</div>
      </div>

      <div class="quickRow">
        <button class="quick btnIcon" id="btnRock"><img src="./Rock.png" alt="ë¬µ(ë°”ìœ„)">ë¬µ</button>
        <button class="quick btnIcon" id="btnScissors"><img src="./Scissors.png" alt="ì°Œ(ê°€ìœ„)">ì°Œ</button>
        <button class="quick btnIcon" id="btnPaper"><img src="./Paper.png" alt="ë¹ (ë³´)">ë¹ </button>
      </div>
    </div>
  </div>

<script>
  // ====== ìœ í‹¸ ======
  const MOVES = ["rock", "scissors", "paper"];
  const MOVE_KO = { rock: "ë¬µ", scissors: "ì°Œ", paper: "ë¹ " };

  // ì´ë¯¸ì§€ íŒŒì¼(HTMLê³¼ ê°™ì€ í´ë”)
  const IMG = {
    rock: "./Rock.png",
    scissors: "./Scissors.png",
    paper: "./Paper.png",
    win: "./Win.png",
    lose: "./Lose.png",
  };

  const AUTO_NEXT_DELAY_MS = 650; // ë¼ìš´ë“œ ì´ëª¨í‹°ì½˜ ë‚˜ì˜¨ ë’¤ ìë™ ì§„í–‰ ë”œë ˆì´

  function randomMove(){ return MOVES[Math.floor(Math.random() * MOVES.length)]; }

  // ê²°ê³¼: "win" | "lose" | "draw" (í”Œë ˆì´ì–´ ê¸°ì¤€)
  function rpsResult(player, cpu){
    if(player === cpu) return "draw";
    if(
      (player === "rock" && cpu === "scissors") ||
      (player === "scissors" && cpu === "paper") ||
      (player === "paper" && cpu === "rock")
    ) return "win";
    return "lose";
  }

  function nowHHMM(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${hh}:${mm}`;
  }

  // ====== ìƒíƒœ ======
  let phase = "rps";       // "rps" | "mjp"
  let attacker = null;     // "player" | "cpu" | null
  let roundOver = false;
  let matchOver = false;

  let roundNo = 1;
  let matchWinsPlayer = 0;
  let matchWinsCpu = 0;
  const WIN_TARGET = 2;

  // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œì–´
  let cpuTypingRow = null;
  let cpuTypingTimeout = null;

  // (ì½ìŒ) ê°€ì¥ ìµœê·¼ í”Œë ˆì´ì–´ ë©”ì‹œì§€ì˜ readLine ì¶”ì 
  let lastMyReadLine = null;

  // ìë™ ë¼ìš´ë“œ ì§„í–‰ íƒ€ì´ë¨¸(ì¤‘ë³µ ë°©ì§€)
  let autoNextTimer = null;

  // ====== DOM ======
  const chatEl = document.getElementById("chat");
  const statusEl = document.getElementById("status");
  const headerSub = document.getElementById("headerSub");

  const pillPhase = document.getElementById("pillPhase");
  const pillAttacker = document.getElementById("pillAttacker");
  const pillRound = document.getElementById("pillRound");
  const pillMatch = document.getElementById("pillMatch");

  const btnRock = document.getElementById("btnRock");
  const btnScissors = document.getElementById("btnScissors");
  const btnPaper = document.getElementById("btnPaper");
  const btnNextRound = document.getElementById("btnNextRound");
  const btnRestartMatch = document.getElementById("btnRestartMatch");

  function phaseLabel(){ return phase === "rps" ? "ê°€ìœ„ë°”ìœ„ë³´(ê³µê²©ì ê²°ì •)" : "ë¬µì°Œë¹ "; }
  function attackerLabel(){
    if(!attacker) return "-";
    return attacker === "player" ? "í”Œë ˆì´ì–´" : "ì»´í“¨í„°";
  }
  function roleOf(who){
    if(!attacker) return "ìˆ˜ë¹„ì";
    return attacker === who ? "ê³µê²©ì" : "ìˆ˜ë¹„ì";
  }

  function setButtonsEnabled(enabled){
    [btnRock, btnScissors, btnPaper].forEach(b => b.disabled = !enabled);
  }

  function render(){
    pillPhase.textContent = `ë‹¨ê³„: ${phaseLabel()}`;
    pillAttacker.textContent = `ê³µê²©ì: ${attackerLabel()}`;
    pillRound.textContent = `ë¼ìš´ë“œ: ${roundNo}`;
    pillMatch.textContent = `ë§¤ì¹˜: í”Œë ˆì´ì–´ ${matchWinsPlayer}ìŠ¹ : ${matchWinsCpu}ìŠ¹ ì»´í“¨í„° (${WIN_TARGET}ìŠ¹ ì„ ì·¨)`;
    headerSub.textContent = `ì»´í“¨í„°(${roleOf("cpu")}) vs í”Œë ˆì´ì–´(${roleOf("player")}) Â· 3íŒ 2ì„ ìŠ¹`;

    const canPlay = !matchOver && !roundOver;
    setButtonsEnabled(canPlay);

    // ìë™ ë¼ìš´ë“œ ì§„í–‰: ë²„íŠ¼ì€ ì•ˆë‚´ìš©ìœ¼ë¡œë§Œ
    btnNextRound.disabled = true;
  }

  // ====== ì±„íŒ… UI ======
  function scrollToBottom(){
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function addSys(text){
    const row = document.createElement("div");
    row.className = "row sys";
    const bubble = document.createElement("div");
    bubble.className = "bubble sys";
    bubble.textContent = text;
    row.appendChild(bubble);
    chatEl.appendChild(row);
    scrollToBottom();
  }

  function addCpuText(text, meta){
    const row = document.createElement("div");
    row.className = "row left";

    const avatar = document.createElement("div");
    avatar.className = "avatar cpu";
    avatar.textContent = "C";

    const bubble = document.createElement("div");
    bubble.className = "bubble left";
    bubble.textContent = text;

    const metaEl = document.createElement("div");
    metaEl.className = "meta";
    metaEl.textContent = meta || nowHHMM();

    row.appendChild(avatar);
    row.appendChild(bubble);
    row.appendChild(metaEl);

    chatEl.appendChild(row);
    scrollToBottom();
  }

  function addPlayerText(text, meta){
    const row = document.createElement("div");
    row.className = "row right";

    const readLine = document.createElement("div");
    readLine.className = "readLine";
    readLine.textContent = "ì „ì†¡ë¨";

    const metaEl = document.createElement("div");
    metaEl.className = "meta";
    metaEl.textContent = meta || nowHHMM();

    const bubble = document.createElement("div");
    bubble.className = "bubble right";
    bubble.textContent = text;

    row.appendChild(readLine);
    row.appendChild(metaEl);
    row.appendChild(bubble);

    chatEl.appendChild(row);
    scrollToBottom();

    if(lastMyReadLine) lastMyReadLine.textContent = "ì½ìŒ";
    lastMyReadLine = readLine;

    setTimeout(() => {
      if(readLine === lastMyReadLine) readLine.textContent = "ì½ìŒ";
    }, 250);
  }

  // ===== ì´ë¯¸ì§€ ë§í’ì„  =====
  function addPlayerImage(imgSrc, altText){
    const row = document.createElement("div");
    row.className = "row right";

    const readLine = document.createElement("div");
    readLine.className = "readLine";
    readLine.textContent = "ì½ìŒ";

    const bubble = document.createElement("div");
    bubble.className = "bubble right image";

    const img = document.createElement("img");
    img.src = imgSrc;
    img.alt = altText;

    bubble.appendChild(img);
    row.appendChild(readLine);
    row.appendChild(bubble);

    chatEl.appendChild(row);
    scrollToBottom();

    if(lastMyReadLine) lastMyReadLine.textContent = "ì½ìŒ";
  }

  function addCpuImage(imgSrc, altText){
    const row = document.createElement("div");
    row.className = "row left";

    const avatar = document.createElement("div");
    avatar.className = "avatar cpu";
    avatar.textContent = "C";

    const bubble = document.createElement("div");
    bubble.className = "bubble left image";

    const img = document.createElement("img");
    img.src = imgSrc;
    img.alt = altText;

    bubble.appendChild(img);
    row.appendChild(avatar);
    row.appendChild(bubble);

    chatEl.appendChild(row);
    scrollToBottom();
  }

  // ===== íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° =====
  function showCpuTyping(){
    hideCpuTyping();

    const row = document.createElement("div");
    row.className = "row left";

    const avatar = document.createElement("div");
    avatar.className = "avatar cpu";
    avatar.textContent = "C";

    const typing = document.createElement("div");
    typing.className = "typing";
    typing.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;

    row.appendChild(avatar);
    row.appendChild(typing);

    chatEl.appendChild(row);
    cpuTypingRow = row;
    scrollToBottom();
  }

  function hideCpuTyping(){
    if(cpuTypingTimeout){
      clearTimeout(cpuTypingTimeout);
      cpuTypingTimeout = null;
    }
    if(cpuTypingRow && cpuTypingRow.parentNode){
      cpuTypingRow.parentNode.removeChild(cpuTypingRow);
    }
    cpuTypingRow = null;
  }

  // ===== ë¼ìš´ë“œ/ë§¤ì¹˜ =====
  function clearAutoNext(){
    if(autoNextTimer){
      clearTimeout(autoNextTimer);
      autoNextTimer = null;
    }
  }

  function scheduleAutoNextRound(){
    clearAutoNext();
    if(matchOver) return;

    autoNextTimer = setTimeout(() => {
      if(matchOver) return;
      roundNo += 1;
      startNewRound();
    }, AUTO_NEXT_DELAY_MS);
  }

  function startNewRound(){
    phase = "rps";
    attacker = null;
    roundOver = false;

    statusEl.textContent = `R${roundNo} ì‹œì‘: ì•„ë˜ì—ì„œ ë¬µ/ì°Œ/ë¹ ë¥¼ ëˆŒëŸ¬ ì§„í–‰í•˜ì„¸ìš”.`;
    addSys(`R${roundNo} ì‹œì‘`);
    render();
  }

  function endRound(winner){ // "player" | "cpu"
    roundOver = true;

    if(winner === "player") matchWinsPlayer += 1;
    else matchWinsCpu += 1;

    // ë¼ìš´ë“œ ê²°ê³¼ ì‹œìŠ¤í…œ ë©”ì‹œì§€
    const roundMsg = (winner === "player")
      ? `R${roundNo} ìŠ¹ë¦¬! :D (í”Œë ˆì´ì–´)`
      : `R${roundNo} íŒ¨ë°°â€¦ T_T (ì»´í“¨í„°)`;
    addSys(roundMsg);

    // âœ… ë¼ìš´ë“œë§ˆë‹¤ ìŠ¹/íŒ¨ ì´ëª¨í‹°ì½˜(í”Œë ˆì´ì–´ë§Œ)
    if(winner === "player"){
      addPlayerImage(IMG.win, "ìŠ¹ë¦¬ ì´ëª¨í‹°ì½˜ (Win)");
    } else {
      addPlayerImage(IMG.lose, "íŒ¨ë°° ì´ëª¨í‹°ì½˜ (Lose)");
    }

    // ë§¤ì¹˜ ì¢…ë£Œ ì²´í¬
    if(matchWinsPlayer >= WIN_TARGET || matchWinsCpu >= WIN_TARGET){
      matchOver = true;
      const matchWinner = matchWinsPlayer >= WIN_TARGET ? "í”Œë ˆì´ì–´" : "ì»´í“¨í„°";
      const matchMsg = (matchWinner === "í”Œë ˆì´ì–´")
        ? `ë§¤ì¹˜ ìŠ¹ë¦¬!! ^^ (2ìŠ¹ ì„ ì·¨)`
        : `ë§¤ì¹˜ íŒ¨ë°°â€¦ ã… ã…  (ìƒëŒ€ 2ìŠ¹ ì„ ì·¨)`;
      addSys(matchMsg);
      statusEl.textContent = `ë§¤ì¹˜ ì¢…ë£Œ! ${matchWinner}ê°€ ${WIN_TARGET}ìŠ¹ ì„ ì·¨ ğŸ‰ (ë§¤ì¹˜ ì¬ì‹œì‘ ê°€ëŠ¥)`;
      render();
      return; // â— ë§¤ì¹˜ ëì´ë©´ ìë™ ë¼ìš´ë“œ ì§„í–‰ ì•ˆ í•¨
    }

    statusEl.textContent = `ë¼ìš´ë“œ ì¢…ë£Œ! ${winner === "player" ? "í”Œë ˆì´ì–´" : "ì»´í“¨í„°"} ìŠ¹ë¦¬ ğŸ (ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¼ìš´ë“œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤)`;
    render();

    // âœ… (ìš”ì²­1) ìµœì¢… ìŠ¹ë¦¬ìê°€ ìƒê¸°ê¸° ì „ê¹Œì§€ ìë™ ë¼ìš´ë“œ ì§„í–‰(ì´ëª¨í‹°ì½˜ í›„)
    scheduleAutoNextRound();
  }

  function resetMatch(){
    hideCpuTyping();
    clearAutoNext();

    phase = "rps";
    attacker = null;
    roundOver = false;
    matchOver = false;

    roundNo = 1;
    matchWinsPlayer = 0;
    matchWinsCpu = 0;

    chatEl.innerHTML = "";
    lastMyReadLine = null;

    addSys("ë§¤ì¹˜ ì¬ì‹œì‘");
    statusEl.textContent = "ë§¤ì¹˜ê°€ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ë¬µ/ì°Œ/ë¹  ì´ëª¨í‹°ì½˜ì„ ì „ì†¡í•˜ì„¸ìš”.";
    render();
  }

  // ===== í„´ ì²˜ë¦¬(íƒ€ì´í•‘ í¬í•¨) =====
  function onTurn(playerMove){
    if(matchOver || roundOver) return;

    // í”Œë ˆì´ì–´ëŠ” ì„ íƒë„ "ì´ëª¨í‹°ì½˜"ìœ¼ë¡œ ì „ì†¡
    addPlayerImage(IMG[playerMove], `í”Œë ˆì´ì–´ ì„ íƒ: ${MOVE_KO[playerMove]}`);

    // ì»´í“¨í„°ëŠ” íƒ€ì´í•‘ í›„ ì„ íƒì„ ì´ëª¨í‹°ì½˜ìœ¼ë¡œ ì „ì†¡
    showCpuTyping();
    setButtonsEnabled(false);

    const cpuDelay = 420 + Math.floor(Math.random() * 380);
    cpuTypingTimeout = setTimeout(() => {
      hideCpuTyping();

      const cpuMove = randomMove();
      const result = rpsResult(playerMove, cpuMove);

      addCpuImage(IMG[cpuMove], `ì»´í“¨í„° ì„ íƒ: ${MOVE_KO[cpuMove]}`);

      // 1) ê³µê²©ì ê²°ì •
      if(phase === "rps"){
        if(result === "draw"){
          statusEl.textContent = "ë¬´ìŠ¹ë¶€! ë‹¤ì‹œ ê°€ìœ„ë°”ìœ„ë³´(ê³µê²©ì ê²°ì •).";
          addSys("ë¬´ìŠ¹ë¶€ â†’ ê³µê²©ì ë¯¸ì •(ì¬ì‹œë„) :|");
          render();
          return;
        }
        attacker = (result === "win") ? "player" : "cpu";
        phase = "mjp";
        statusEl.textContent = `${attackerLabel()}ê°€ ê³µê²©ì! ì´ì œ ë¬µì°Œë¹ `;
        addSys(`ê³µê²©ì ê²°ì • â†’ ${attackerLabel()} (ë¬µì°Œë¹  ì‹œì‘)`);
        render();
        return;
      }

      // 2) ë¬µì°Œë¹ 
      if(playerMove === cpuMove){
        addSys(`ê°™ì€ ìˆ˜! ê³µê²©ì(${attackerLabel()}) ë¼ìš´ë“œ ìŠ¹ë¦¬! ${attacker === "player" ? "^^" : "ã… ã… "}`);
        endRound(attacker);
        return;
      }

      // ë‹¤ë¥¸ ìˆ˜ë©´ ê³µê²©ì ë³€ê²½
      attacker = (result === "win") ? "player" : "cpu";
      statusEl.textContent = `ê³µê²©ì ë³€ê²½! í˜„ì¬ ê³µê²©ì: ${attackerLabel()}`;
      addSys(`ê³µê²©ì ë³€ê²½ â†’ ${attackerLabel()} ${attacker === "player" ? ":)" : ":("}`);
      render();
    }, cpuDelay);
  }

  // ===== ì´ë²¤íŠ¸ =====
  btnRock.addEventListener("click", () => onTurn("rock"));
  btnScissors.addEventListener("click", () => onTurn("scissors"));
  btnPaper.addEventListener("click", () => onTurn("paper"));
  btnRestartMatch.addEventListener("click", () => resetMatch());

  // (ìë™ ë¼ìš´ë“œë¼ í´ë¦­ì€ ë¬´íš¨/ì•ˆë‚´ìš©)
  btnNextRound.addEventListener("click", () => { /* noop */ });

  // ì´ˆê¸°
  render();
  startNewRound();
</script>
</body>
</html>
